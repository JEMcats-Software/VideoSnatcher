<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideoSnatcher</title>
    <style>
        /* Loader styles remain unchanged */
        .loader {
            --s: 20px;
            --_d: calc(0.353*var(--s));
            width: calc(var(--s) + var(--_d));
            aspect-ratio: 1;
            display: grid;
        }

        .loader:before,
        .loader:after {
            content: "";
            grid-area: 1/1;
            clip-path: polygon(var(--_d) 0, 100% 0, 100% calc(100% - var(--_d)), calc(100% - var(--_d)) 100%, 0 100%, 0 var(--_d));
            background: conic-gradient(from -90deg at calc(100% - var(--_d)) var(--_d),
                    #E53935 135deg, #972523 0 270deg, #bd2f2d 0);
            animation: l6 2s infinite;
        }

        .loader:after {
            animation-delay: -1s;
        }

        @keyframes l6 {
            0% {
                transform: translate(0, 0)
            }

            25% {
                transform: translate(30px, 0)
            }

            50% {
                transform: translate(30px, 30px)
            }

            75% {
                transform: translate(0, 30px)
            }

            100% {
                transform: translate(0, 0)
            }
        }

        /* Custom CSS to replace Tailwind */
        html,
        body {
            margin: 0;
            padding: 0;
        }

        body {
            background-color: #f7fafc;
            /* Tailwind's bg-gray-100 */
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: sans-serif;
            position: relative;
        }

        .icon-container {
            position: absolute;
            top: 1rem;
            left: 1rem;
        }

        .card {
            background-color: white;
            border-radius: 1rem;
            /* approximates rounded-2xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            /* shadow-lg */
            padding: 2rem;
            /* p-8 */
            max-width: 32rem;
            /* max-w-lg */
            width: 100%;
            text-align: center;
        }

        .link-blue {
            color: #2563eb;
            /* Tailwind's text-blue-600 */
            text-decoration: underline;
            margin-bottom: 1rem;
            cursor: pointer;
        }

        .input-btn-container {
            display: flex;
            margin-bottom: 1rem;
        }

        .input-field {
            flex-grow: 1;
            padding: 0.5rem;
            /* p-2 */
            border: 1px solid #ccc;
            border-right: none;
            border-top-left-radius: 0.5rem;
            /* rounded-l-lg */
            border-bottom-left-radius: 0.5rem;
            outline: none;
            font-size: 1rem;
        }

        .input-field-rounded {
            flex-grow: 1;
            padding: 0.5rem;
            /* p-2 */
            border: 1px solid #ccc;
            border-radius: 0.5rem;
            outline: none;
            font-size: 1rem;
            width: 90%;
        }

        .submit-btn {
            background-color: #ef4444;
            /* red-500 */
            color: white;
            padding: 0.5rem 1rem;
            /* py-2, px-4 */
            border: 1px solid #ef4444;
            border-left: none;
            border-top-right-radius: 0.5rem;
            /* rounded-r-lg */
            border-bottom-right-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
        }

        .submit-btn:hover {
            background-color: #dc2626;
            /* red-600 */
            border-color: #dc2626;
        }

        .mx-auto {
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>

<body>
    <div class="icon-container">
        <img src="../assets/icon.png" alt="Icon" style="width: 40px; height: 40px;">
    </div>
    <div class="card">
        <p onclick="run_youtube_signin()" class="link-blue">Planning to download from YouTube? Click here first!</p>
        <div class="input-btn-container">
            <input id="url_input" type="text" placeholder="Enter video URL..." class="input-field">
            <button onclick="get_options()" class="submit-btn">Download</button>
        </div>
        <input id="vimeo_pass" style="display: none;" type="text" placeholder="Enter video password. If there is none, please leave blank." class="input-field-rounded">
        <p onclick="view_supported()" class="link-blue">Over 900 sites supported!</p>
        <div id="loader" style="margin-bottom: 10px; display: none;" class="loader mx-auto"></div>
    </div>
    <script>
        document.getElementById('url_input').addEventListener('input', function (event) {
            const inputField = event.target;
            const inputValue = inputField.value;

            if (inputValue.includes("vimeo.com")) {
            document.getElementById("vimeo_pass").style.display = "block";
            } else {
            document.getElementById("vimeo_pass").style.display = "none";
            }
        });

        let download_stage = 0;
        let current_vid_options = [];
        const urlParams = new URLSearchParams(window.location.search);
        
        function parseArrayToDictionary(arr) {
            const result = {};
            result.id = arr[0];
            arr.forEach(value => {
                if (value.includes('x')) {
                    result.res = value;
                } else if (value.includes('only') && value !== 'only') {
                    result.contains = value;
                } else if (value.endsWith('MiB')) {
                    result.size = value;
                } else if (['mp4', 'mp3', 'webm'].includes(value)) {
                    result.format = value;
                }
            });

            return result;
        }

        function getParam(param) {
            return urlParams.get(param);
        }

        function view_supported() {
            fetch(`http://localhost:${getParam("port")}/show_supported_list`)
                .then(response => {
                    if (response.status === 200) {
                        return;
                    } else {
                        alert("Failed To Open List");
                    }
                })
                .catch(error => {
                    alert("Failed To Open List");
                });
        }

        function run_youtube_signin() {
            fetch(`http://localhost:${getParam("port")}/run_youtube_signin`)
                .then(response => {
                    if (response.status === 200) {
                        return;
                    } else {
                        alert("Failed To Run Youtube Setup");
                    }
                })
                .catch(error => {
                    alert("Failed To Run Youtube Setup");
                });
        }

        function get_options() {
            const urlInput = document.querySelector(".input-field");
            if (urlInput.value === "") {
                alert("Please enter a URL");
                return;
            } else {
                const vimeo_pass = document.getElementById("vimeo_pass");
                download_stage = 1;
                document.getElementById("loader").style.display = "";
                let fetch_url;
                if (vimeo_pass.value !== "") {
                    fetch_url = `http://localhost:${getParam("port")}/get_vid_options?url=${urlInput.value}&vimeoPass=${vimeo_pass.value}`;
                } else {
                    fetch_url = `http://localhost:${getParam("port")}/get_vid_options?url=${urlInput.value}`;
                }
                fetch(fetch_url)
                    .then(response => {
                        if (response.status === 200) {
                            response.json().then(data => {
                                document.getElementById("loader").style.display = "none";
                                current_vid_options = [];
                                data.forEach(option => {
                                    current_vid_options.push(parseArrayToDictionary(option));
                                });
                                console.log(current_vid_options);
                            });
                            return;
                        } else {
                            response.text().then(text => {
                                if (text.includes("please try login")) {
                                    alert("Failed To Get Info On That Video. Please try running the Youtube Setup.");
                                } else {
                                    alert("Failed To Get Info On That Video. Please make sure the URL is valid.");
                                }
                                document.getElementById("loader").style.display = "none";
                            });
                        }
                    })
                    .catch(error => {
                        alert("Failed To Get Info On That Video. Please make sure the URL is valid.");
                        document.getElementById("loader").style.display = "none";
                    });
            }
        }
    </script>
</body>

</html>